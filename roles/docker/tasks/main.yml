---
# tasks file for docker
- name: ensure docker config dir exists
  sudo: yes
  file:
    path: /root/.docker
    state: directory
  tags:
    - docker

- name: setup private docker registry credentials
  sudo: yes
  when: private_docker_registry|bool
  template:
    src: config.json.j2
    dest: /root/.docker/config.json
  tags:
    - docker

- name: deploy docker service
  sudo: yes
  sudo_user: root
  template:
    src: docker.service.j2
    dest: /etc/systemd/system/docker.service
  notify:
    - reload systemd
    - restart docker
  tags:
    - docker

- name: reload systemd
  sudo: yes
  command: systemctl daemon-reload
  notify:
    - restart docker

- name: ensure docker is running (and enable it at boot)
  sudo: yes
  service:
    name: docker
    state: started
    enabled: yes
  tags:
    - docker
